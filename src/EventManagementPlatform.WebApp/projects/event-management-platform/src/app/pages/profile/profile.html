<div class="profile">
  <app-page-header
    title="Profile"
    subtitle="Manage your account settings"
  ></app-page-header>

  <mat-tab-group class="profile__tabs">
    <mat-tab label="Profile Information">
      <div class="profile__tab-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Personal Information</mat-card-title>
            <mat-card-subtitle>Update your personal details</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <form [formGroup]="profileForm" (ngSubmit)="onProfileSubmit()" class="profile__form">
              <div class="profile__form-row">
                <mat-form-field appearance="outline">
                  <mat-label>First Name</mat-label>
                  <input matInput formControlName="firstName">
                  @if (profileForm.get('firstName')?.hasError('required')) {
                    <mat-error>First name is required</mat-error>
                  }
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Last Name</mat-label>
                  <input matInput formControlName="lastName">
                  @if (profileForm.get('lastName')?.hasError('required')) {
                    <mat-error>Last name is required</mat-error>
                  }
                </mat-form-field>
              </div>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Email</mat-label>
                <input matInput formControlName="email" type="email">
                <mat-hint>Email cannot be changed</mat-hint>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Phone Number</mat-label>
                <input matInput formControlName="phoneNumber" placeholder="+1234567890">
                @if (profileForm.get('phoneNumber')?.hasError('pattern')) {
                  <mat-error>Please enter a valid phone number</mat-error>
                }
              </mat-form-field>

              <div class="profile__form-actions">
                <button
                  mat-flat-button
                  color="primary"
                  type="submit"
                  [disabled]="isProfileLoading || !profileForm.dirty"
                >
                  @if (isProfileLoading) {
                    <mat-spinner diameter="20"></mat-spinner>
                  } @else {
                    Save Changes
                  }
                </button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <mat-tab label="Security">
      <div class="profile__tab-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Change Password</mat-card-title>
            <mat-card-subtitle>Update your password to keep your account secure</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <form [formGroup]="passwordForm" (ngSubmit)="onPasswordSubmit()" class="profile__form">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Current Password</mat-label>
                <input
                  matInput
                  formControlName="currentPassword"
                  [type]="hideCurrentPassword ? 'password' : 'text'"
                >
                <button
                  mat-icon-button
                  matSuffix
                  type="button"
                  (click)="hideCurrentPassword = !hideCurrentPassword"
                >
                  <mat-icon>{{ hideCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
                @if (passwordForm.get('currentPassword')?.hasError('required')) {
                  <mat-error>Current password is required</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>New Password</mat-label>
                <input
                  matInput
                  formControlName="newPassword"
                  [type]="hideNewPassword ? 'password' : 'text'"
                >
                <button
                  mat-icon-button
                  matSuffix
                  type="button"
                  (click)="hideNewPassword = !hideNewPassword"
                >
                  <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
                @if (passwordForm.get('newPassword')?.hasError('required')) {
                  <mat-error>New password is required</mat-error>
                }
                @if (passwordForm.get('newPassword')?.hasError('minlength')) {
                  <mat-error>Password must be at least 8 characters</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Confirm New Password</mat-label>
                <input
                  matInput
                  formControlName="confirmPassword"
                  [type]="hideConfirmPassword ? 'password' : 'text'"
                >
                <button
                  mat-icon-button
                  matSuffix
                  type="button"
                  (click)="hideConfirmPassword = !hideConfirmPassword"
                >
                  <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
                @if (passwordForm.get('confirmPassword')?.hasError('required')) {
                  <mat-error>Please confirm your new password</mat-error>
                }
                @if (passwordForm.get('confirmPassword')?.hasError('passwordMismatch')) {
                  <mat-error>Passwords do not match</mat-error>
                }
              </mat-form-field>

              <div class="profile__form-actions">
                <button
                  mat-flat-button
                  color="primary"
                  type="submit"
                  [disabled]="isPasswordLoading || !passwordForm.dirty"
                >
                  @if (isPasswordLoading) {
                    <mat-spinner diameter="20"></mat-spinner>
                  } @else {
                    Change Password
                  }
                </button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
